{"version":3,"sources":["auth/twitter/passport.js"],"names":["setup","User","config","passport","use","TwitterStrategy","consumerKey","twitter","clientID","consumerSecret","clientSecret","callbackURL","token","tokenSecret","profile","done","_json","id","findOne","exec","then","user","name","displayName","username","role","provider","save","savedUser","catch","err"],"mappings":";;;;;QAGgBA,K,GAAAA,K;;AAHhB;;;;AACA;;;;AAEO,SAASA,KAAT,CAAeC,IAAf,EAAqBC,MAArB,EAA6B;AAChCC,uBAASC,GAAT,CAAa,IAAIC,yBAAJ,CAAoB;AAC7BC,qBAAaJ,OAAOK,OAAP,CAAeC,QADC;AAE7BC,wBAAgBP,OAAOK,OAAP,CAAeG,YAFF;AAG7BC,qBAAaT,OAAOK,OAAP,CAAeI;AAHC,KAApB,EAKb,UAASC,KAAT,EAAgBC,WAAhB,EAA6BC,OAA7B,EAAsCC,IAAtC,EAA4C;AACxCD,gBAAQE,KAAR,CAAcC,EAAd,GAAoB,GAAEH,QAAQE,KAAR,CAAcC,EAAG,EAAvC;AACAH,gBAAQG,EAAR,GAAc,GAAEH,QAAQG,EAAG,EAA3B;;AAEAhB,aAAKiB,OAAL,CAAa,EAAC,cAAcJ,QAAQG,EAAvB,EAAb,EAAyCE,IAAzC,GACKC,IADL,CACUC,QAAQ;AACV,gBAAGA,IAAH,EAAS;AACL,uBAAON,KAAK,IAAL,EAAWM,IAAX,CAAP;AACH;;AAEDA,mBAAO,IAAIpB,IAAJ,CAAS;AACZqB,sBAAMR,QAAQS,WADF;AAEZC,0BAAUV,QAAQU,QAFN;AAGZC,sBAAM,MAHM;AAIZC,0BAAU,SAJE;AAKZnB,yBAASO,QAAQE;AALL,aAAT,CAAP;AAOAK,iBAAKM,IAAL,GACKP,IADL,CACUQ,aAAab,KAAK,IAAL,EAAWa,SAAX,CADvB,EAEKC,KAFL,CAEWC,OAAOf,KAAKe,GAAL,CAFlB;AAGH,SAhBL,EAiBKD,KAjBL,CAiBWC,OAAOf,KAAKe,GAAL,CAjBlB;AAkBH,KA3BY,CAAb;AA4BH","file":"passport.js","sourcesContent":["import passport from 'passport';\nimport {Strategy as TwitterStrategy} from 'passport-twitter';\n\nexport function setup(User, config) {\n    passport.use(new TwitterStrategy({\n        consumerKey: config.twitter.clientID,\n        consumerSecret: config.twitter.clientSecret,\n        callbackURL: config.twitter.callbackURL\n    },\n    function(token, tokenSecret, profile, done) {\n        profile._json.id = `${profile._json.id}`;\n        profile.id = `${profile.id}`;\n\n        User.findOne({'twitter.id': profile.id}).exec()\n            .then(user => {\n                if(user) {\n                    return done(null, user);\n                }\n\n                user = new User({\n                    name: profile.displayName,\n                    username: profile.username,\n                    role: 'user',\n                    provider: 'twitter',\n                    twitter: profile._json\n                });\n                user.save()\n                    .then(savedUser => done(null, savedUser))\n                    .catch(err => done(err));\n            })\n            .catch(err => done(err));\n    }));\n}\n"]}
{"version":3,"sources":["auth/facebook/passport.js"],"names":["setup","User","config","passport","use","FacebookStrategy","clientID","facebook","clientSecret","callbackURL","profileFields","accessToken","refreshToken","profile","done","findOne","id","exec","then","user","name","displayName","email","emails","value","role","provider","_json","save","savedUser","catch","err"],"mappings":";;;;;QAGgBA,K,GAAAA,K;;AAHhB;;;;AACA;;;;AAEO,SAASA,KAAT,CAAeC,IAAf,EAAqBC,MAArB,EAA6B;AAChCC,uBAASC,GAAT,CAAa,IAAIC,0BAAJ,CAAqB;AAC9BC,kBAAUJ,OAAOK,QAAP,CAAgBD,QADI;AAE9BE,sBAAcN,OAAOK,QAAP,CAAgBC,YAFA;AAG9BC,qBAAaP,OAAOK,QAAP,CAAgBE,WAHC;AAI9BC,uBAAe,CACX,aADW,EAEX,QAFW;AAJe,KAArB,EASb,UAASC,WAAT,EAAsBC,YAAtB,EAAoCC,OAApC,EAA6CC,IAA7C,EAAmD;AAC/Cb,aAAKc,OAAL,CAAa,EAAC,eAAeF,QAAQG,EAAxB,EAAb,EAA0CC,IAA1C,GACKC,IADL,CACUC,QAAQ;AACV,gBAAGA,IAAH,EAAS;AACL,uBAAOL,KAAK,IAAL,EAAWK,IAAX,CAAP;AACH;;AAEDA,mBAAO,IAAIlB,IAAJ,CAAS;AACZmB,sBAAMP,QAAQQ,WADF;AAEZC,uBAAOT,QAAQU,MAAR,CAAe,CAAf,EAAkBC,KAFb;AAGZC,sBAAM,MAHM;AAIZC,0BAAU,UAJE;AAKZnB,0BAAUM,QAAQc;AALN,aAAT,CAAP;AAOAR,iBAAKS,IAAL,GACKV,IADL,CACUW,aAAaf,KAAK,IAAL,EAAWe,SAAX,CADvB,EAEKC,KAFL,CAEWC,OAAOjB,KAAKiB,GAAL,CAFlB;AAGH,SAhBL,EAiBKD,KAjBL,CAiBWC,OAAOjB,KAAKiB,GAAL,CAjBlB;AAkBH,KA5BY,CAAb;AA6BH","file":"passport.js","sourcesContent":["import passport from 'passport';\nimport {Strategy as FacebookStrategy} from 'passport-facebook';\n\nexport function setup(User, config) {\n    passport.use(new FacebookStrategy({\n        clientID: config.facebook.clientID,\n        clientSecret: config.facebook.clientSecret,\n        callbackURL: config.facebook.callbackURL,\n        profileFields: [\n            'displayName',\n            'emails'\n        ]\n    },\n    function(accessToken, refreshToken, profile, done) {\n        User.findOne({'facebook.id': profile.id}).exec()\n            .then(user => {\n                if(user) {\n                    return done(null, user);\n                }\n\n                user = new User({\n                    name: profile.displayName,\n                    email: profile.emails[0].value,\n                    role: 'user',\n                    provider: 'facebook',\n                    facebook: profile._json\n                });\n                user.save()\n                    .then(savedUser => done(null, savedUser))\n                    .catch(err => done(err));\n            })\n            .catch(err => done(err));\n    }));\n}\n"]}